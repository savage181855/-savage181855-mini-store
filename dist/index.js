let t=!1,e=!1;function o(e={}){t=!0;const o=Page;Page=function(t){const n={...e,...t,onLoad(){const{useStoreRef:o,mapState:n,mapActions:c,watch:s}=t;o&&o(this,n,c,s),e?.onLoad?.call(this,...arguments),t?.onLoad?.call(this,...arguments)}};c(["onShow","onReady","onHide","onUnload","onPullDownRefresh","onReachBottom","onPageScroll","onResize","onTabItemTap"],n,e,t),o(n)}}function n(t={}){e=!0;const o=Component;Component=function(e){const n={...t,...e,attached(){const{useStoreRef:o,mapState:n,mapActions:c,watch:s}=e;o&&o(this,n,c,s),e?.attached?.call(this,...arguments),t?.attached?.call(this,...arguments)},detached(){e.useStoreRef&&this.data.store.cancelUse(this),e.detached?.call(this,...arguments),t?.detached?.call(this,...arguments)},lifetimes:{attached(){const{useStoreRef:o,mapState:n,mapActions:c,watch:s}=e;o&&o(this,n,c,s),e?.lifetimes?.attached?.call(this,...arguments),t?.lifetimes?.attached?.call(this,...arguments)},detached(){e.useStoreRef&&this.data.store.cancelUse(this),e?.lifetimes.detached?.call(this,...arguments),t?.lifetimes?.detached?.call(this,...arguments)}}};c(["created","ready","moved","error","lifetimes.created","lifetimes.ready","lifetimes.moved","lifetimes.error","pageLifetimes.show","pageLifetimes.hide","pageLifetimes.resize"],n,t,e),o(n)}}function c(t,e,o,n){t.forEach((t=>{const c=t.split(".");1===c.length?e[c[0]]=function(){o?.[c[0]]?.call(this,...arguments),n?.[c[0]]?.call(this,...arguments)}:(e[c[0]]={...e?.[c[0]]},(o?.[c[0]]?.[c[1]]||n?.[c[0]]?.[c[1]])&&(e[c[0]][c[1]]=function(){o?.[c[0]]?.[c[1]]?.call(this,...arguments),n?.[c[0]]?.[c[1]]?.call(this,...arguments)}))}))}function s(t,e){return e.replace(/\[(\w+)\]/g,".$1").replace(/\["(\w+)"\]/g,".$1").replace(/\['(\w+)'\]/g,".$1").split(".").reduce(((t,e)=>t?.[e]),t)}function i(t,e){if(t===e)return!0;if("object"!=typeof t||null===t||"object"!=typeof e||null===e)return!1;const o=/Number|Boolean|String|Null|Undefined|Symbol|Function|RegExp|Date/,n=Object.prototype.toString.call(t).slice(8,-1),c=Object.prototype.toString.call(e).slice(8,-1);if("Object"!==n&&"Array"!==n&&"Object"!==c&&"Object"!==c&&o.exec(n)[0]===o.exec(c)[0]&&n===c)return!0;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let o of Object.keys(t)){const n=i(t[o],e[o]);if(!n)return n}return!0}function r(t){if(!t||"object"!=typeof t)return t;if(/Number|Boolean|String|Null|Undefined|Symbol|Function|RegExp|Date/.test(Object.prototype.toString.call(t)))return t;const e="Array"===t.constructor?[]:{};for(let o in t)e[o]="object"==typeof t[o]?r(t[o]):t[o];return e}function a(t,e){return!i(t,e)}setTimeout((()=>{function o(t){console.error(`必须在 app.js 文件 调用 ${t}()，参考：https://www.npmjs.com/package/@savage181855/mini-store`)}t||o("proxyPage"),e||o("proxyComponent")}));const l={subscribeList:{},pubAndNoSub:{},subscribe(t,e){this.pubAndNoSub[t]&&(e(this.pubAndNoSub[t]),Reflect.deleteProperty(this.pubAndNoSub,t)),this.subscribeList[t]?.push(e)||(this.subscribeList[t]=[e])},publish(t,e){const o=this.subscribeList[t];o&&0!==o.length?o.forEach((t=>t(e))):this.pubAndNoSub[t]=e},remove(t,e){const o=this.subscribeList[t];o&&0!==o.length&&(e?o.forEach(((o,n)=>{o===e&&this.subscribeList[t].splice(n,1)})):this.subscribeList[t]=[])}};function u(t){const e={...t.state,...t.actions,patch(t){if("object"==typeof t)for(let e in t)c[e]=t[e];"function"==typeof t&&t(c)},cancelUse(t){t.onUnload()}};!function(t){const e=r(l);for(let o in l)t[o]=e[o]}(e);const o={get:function(t,e,o){const c=Reflect.get(t,e,o);return null!==(s=c)&&"object"==typeof s?n(c):c;var s},set:function(t,e,o,n){const i=r(c),l=Reflect.set(t,e,o,n);return Reflect.ownKeys(c.subscribeList).forEach((t=>{const e=s(i,t),o=s(c,t);a(e,o)&&c.subscribeList[t].forEach((t=>t(e,o)))})),l}};function n(t){return function(t,e){return new Proxy(t,e)}(t,o)}let c=null;return c=n(e),function(t,e=[],o=[],n={}){o.forEach((e=>t[e]=c[e].bind(c))),t.data.store=c;const s={};e.forEach((t=>s[t]=c[t])),t.setData(s);const i={};e.forEach((e=>{i[e]=(o,n)=>{t.setData({[e]:n})},c.subscribe(e,i[e])})),Reflect.ownKeys(n).forEach((e=>{c.subscribe(e,n[e].bind(t))}));const r=t.onUnload||function(){};return t.onUnload=function(){r(),Reflect.ownKeys(i).forEach((t=>c.remove(t,i[t]))),Reflect.ownKeys(n).forEach((t=>c.remove(t,n[t])))},c}}export{u as defineStore,n as proxyComponent,o as proxyPage};
